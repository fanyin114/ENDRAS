<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>早期神经功能恶化风险预测模型</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="app" class="container mx-auto px-4 py-8 max-w-2xl">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">早期神经功能恶化风险预测模型</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="space-y-4">
                <!-- NIHSS -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">NIHSS评分</label>
                    <input type="number" v-model="form.nihss" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- SBP -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">收缩压(mmHg)</label>
                    <input type="number" v-model="form.sbp" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- NEUT -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">中性粒细胞计数(×10^9/L)</label>
                    <input type="number" v-model="form.neut" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- RDW -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">红细胞分布宽度(%)</label>
                    <input type="number" v-model="form.rdw" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- TOAST-LAA -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">TOAST分型是否为大动脉粥样硬化型</label>
                    <select v-model="form.toast_laa" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </div>

                <!-- IAS -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">是否为颅内动脉狭窄</label>
                    <select v-model="form.ias" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </div>

                <button @click="predict" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    预测风险
                </button>
            </div>

            <!-- 结果显示 -->
            <div v-if="result" class="mt-6 p-4 border rounded-md" :class="{'bg-red-50 border-red-200': result.risk_level === '高风险', 'bg-green-50 border-green-200': result.risk_level === '低风险'}">
                <h3 class="font-semibold text-lg mb-2">预测结果</h3>
                <p class="mb-2">风险概率: {{ Math.round(result.risk_probability * 100) / 100 }}%</p>
                <p class="mb-2">风险等级: {{ result.risk_level }}</p>
                <p>{{ result.risk_description }}</p>
            </div>

            <!-- 错误提示 -->
            <div v-if="error" class="mt-6 p-4 bg-red-50 border border-red-200 rounded-md text-red-700">
                {{ error }}
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    form: {
                        nihss: '',
                        sbp: '',
                        neut: '',
                        rdw: '',
                        toast_laa: '0',
                        ias: '0'
                    },
                    result: null,
                    error: null
                }
            },
            methods: {
                async predict() {
                    try {
                        this.error = null;
                        this.result = null;

                        // 验证输入
                        if (!this.form.nihss || !this.form.sbp || !this.form.neut || !this.form.rdw) {
                            this.error = "请填写所有必填项";
                            return;
                        }

                        const response = await axios.post('/api/predict', this.form);
                        this.result = response.data;
                    } catch (error) {
                        this.error = error.response?.data?.error || '预测失败，请稍后重试';
                    }
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
