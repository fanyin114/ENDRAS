<!DOCTYPE html>
<html lang="zh-CN">
<!-- 前面的代码保持不变，直到 script 标签 -->
<script>
    document.getElementById('predictionForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        // 获取表单数据并转换为对象
        const formData = new FormData(e.target);
        const data = {};
        
        // 添加数据收集的日志
        console.log('开始收集表单数据');
        
        for (let [key, value] of formData.entries()) {
            // 确保数值类型的转换
            try {
                if (key === 'toast_laa' || key === 'ias') {
                    data[key] = parseInt(value);
                } else {
                    data[key] = parseFloat(value);
                }
                console.log(`字段 ${key} 的值: ${data[key]}`);
            } catch (error) {
                console.error(`转换字段 ${key} 的值时出错:`, error);
            }
        }
        
        console.log('发送到服务器的数据:', data);
        
        try {
            const response = await fetch('/api/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            console.log('服务器返回的结果:', result);
            
            if (result.success) {
                const resultDiv = document.getElementById('result');
                const riskProbability = document.getElementById('riskProbability');
                const riskLevel = document.getElementById('riskLevel');
                const riskDescription = document.getElementById('riskDescription');
                
                resultDiv.classList.remove('hidden');
                riskProbability.textContent = `${result.risk_probability.toFixed(2)}%`;
                
                // 根据风险等级设置不同的颜色
                let levelColor;
                if (result.risk_level === '高风险') {
                    levelColor = 'text-red-600';
                } else {
                    levelColor = 'text-green-600';
                }
                
                // 移除之前的颜色类
                riskLevel.classList.remove('text-red-600', 'text-green-600');
                // 添加新的颜色类
                riskLevel.classList.add(levelColor);
                
                riskLevel.textContent = result.risk_level;
                riskDescription.textContent = result.risk_description;
                
                // 平滑滚动到结果区域
                resultDiv.scrollIntoView({ behavior: 'smooth' });
            } else {
                // 显示错误信息
                alert(result.error || '计算过程中发生错误，请重试');
            }
        } catch (error) {
            console.error('请求发生错误:', error);
            alert('服务器连接失败，请检查网络连接后重试');
        }
    });

    // 输入验证
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('input', function() {
            const min = parseFloat(this.min);
            const max = parseFloat(this.max);
            let value = parseFloat(this.value);
            
            if (value < min) {
                this.value = min;
            } else if (value > max) {
                this.value = max;
            }
        });
    });
</script>
</body>
</html>
